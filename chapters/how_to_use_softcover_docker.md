# How to use the softcover docker image to publish your book

This article will show you how to use the softcover docker image to run the softcover commands needed to create and publish your book or article to the softcover service.

When I tried to use the softcover CLI command line tooling on my Mac OS machine, I ran into a few installation issues.

Fortunately I found a Docker image with the softcover tools pre installed that was build by one of the softcover team members.

I was able to use this Docker image to build and publish my book (in progress) to the platform.

I had to figure out a few things along the way when using the image and I decided to document the commands I used so that others can benefit from my experience.

This article assumes that you have Docker installed on your machine.

You can download and install Docker desktop from [https://docs.docker.com/desktop/mac/install](https://docs.docker.com/desktop/mac/install).

## Pulling the image

The first thing you want to do is pull down the image from Docker hub. It is fairly large image so be warned that it will take a bit of time.

The image is hosted at `[https://hub.docker.com/r/softcover/softcover](https://hub.docker.com/r/softcover/softcover)` and the its repo is at [https://github.com/softcover/softcover-docker](https://github.com/softcover/softcover-docker)

Let's pull the image:

```console
docker pull softcover/softcover
```

This command will pull the latest softcover image onto your machine.

## Creating a new book

Now that we have the image downloaded we can run the docker command to create our book.

But first let's setup a directory to hold all our books/articles:

```consloe
mkdir mybooks && cd mybooks
```

From within that directory run the the command to create a new book.:

```console
docker run --rm -v `pwd`:/book softcover/softcover:latest sc new mybook
```

Here we have told the container to run the `sc new` command to create a new book named `mybook`.

The command will create a new directory named `mybook` in the current directory.

If we wanted to create an article instead of a book, we would just need to add the `-a` option to the `sc new` command.

```console
docker run --rm -v `pwd`:/book softcover/softcover:latest sc new -a myarticle
```

> Note: Although we have not specified a working directory option on the command line, the Docker image dockerfile specifies a `/book` working directory. This is why we have a specified a volume map option that maps the current directory `pwd` to the `/book` directory in the container. With this mapping, when we run the `sc new mybook` command, the `mybook` directory is created in the container's `/book` working directory and the working directory content is synched into our current directory.

## Exploring the book directory

Now that we have created our new book, let's move into the `mybook` directory and explore its content.

```console
cd mybook
```

The softcover documentation available at []() provides detailed explanation of the content of this directory.

For our purposes, I will just provide enough detail so we can understand how the book building and publishing commands in the following sections work.

The mybook directory contains contains a `book.txt` file that specifies the table of contents, the preface and the individual book chapters of the published book.

Lets see the contents of this file:

```console
$ cat book.txt

cover
frontmatter:
maketitle
tableofcontents
preface.md
mainmatter:
a_chapter.md
yet_another_chapter.md
```

We can see a number of markdown files with the .md extension listed in the file.

All these markdown files will have a corresponding file of the same name in the `./chapters` directory.

Lets see the contents of the chapters directory:

```console
$ ls -l chapters

a_chapter.md
yet_another_chapter.md
```

As you can see the chapters directory contains the markdown files listed in the Book.txt file.

These set of files are the source files used to generate the html and ebook format files of our book.

The order of the chapter files listed under the `mainmatter:` section determines their corresponding chapter order in the published html or ebook.

The `preface.md` file will hold your own custom preface content for your book and the table of content is autogenerated for you.

Note that if we had created an article instead of a book, there would only be a single chapter file in the Book.txt file.

Here is the content of the Book.txt file for an article:

```console
$ cat book.txt
cover
maketitle
a_chapter.md
```

Correspondingly, the `chapters` directory contains the single markdown file listed in the Book.txt file.

Notice also that there is no preface or table of contents either in the Book.txt file for an article.

## Building html files

As we add, remove and edit markdown files in the chapters directory, we might want to build and preview the content in a web browser.

One way to do this is to build the html files using the `sc build:html` command.

To do so using our docker image we can run the following Docker command from within the `mybook` directory:

```console
docker run --rm -v `pwd`:/book softcover/softcover:latest sc build:html
```

This command uses the markdown files in `./chapters` directory mapped to the `/book/chapters` directory of the container as source files and builds corresponding html output files in the `/book/html` directory in the container which are mapped back to our `./html` directory.

The html generator also generates a `book` html file which includes all the chapters compiled to single html file.

We can then view the html chapter files or the `book` html file from our local `./html` directory, by using a web browser to open the files.

## Serving generated html files

In addition to building the html files we can build and also serve the `book` html file to our local web browser by running the following command instead:

```console
docker run --rm -v `pwd`:/book -d -p 4000:4000 softcover/softcover:latest sc server
```

The above docker command runs the `sc server` softcover command in the container.

The command first runs the `sc build:html` to build the `book` html file in the `/book/html` directory of the container, then starts up a web server inside the container that serves the `book` html file through port 4000 of the container.

> The port number 4000 is exposed in the dockerfile.

Since the docker command maps the container port 4000 to our local port 4000 , we can navigate to localhost:4000 with our local web browser to view the html content.

As we change the content of the `chapters` directory the change is detected and the `sc build:html` command is re-run and web server is reloaded, allowing us to instantly preview the output of our changes.

Of course we can always run the `sc build:html` command using the container to force a regeneration of the html content.

## Resolving issues with the softcover server

In some situations you might run into an issue sometimes where the server running in the container will hang or the container process would exit.

This might happen when you rename the chapter markdown files where the names are out of sync with the Book.txt file. It could also happen if there is an error in the markdown file that causes a markdown file parsing error by the `sc build:html` command.

In this scenario executing the Docker `sc build:html` command manually will display the errors so you can debug and fix the issue.

To check if the container exited you can run this Docker command:

```console
docker ps -a
```

This command will show all running and stopped containers on your system.

If the container has exited you can fix the issue by using the `sc build:html` command and then run the server command again:

```console
docker run --rm -v `pwd`:/book -d -p 4000:4000 softcover/softcover:latest sc server
```

If the container has not exited, you can fix the issue and see if the server starts working again.

If not, then stop the container first then run the server command:

```console
docker stop <contained-hash-id>
docker run --rm -v `pwd`:/book -d -p 4000:4000 softcover/softcover:latest sc server
```

## Publishing the book to softcover.io

In order to publish your book you need to login to softcover.io service and then issue the softcover CLI publishing commands to publish your html and ebook content to the service.

Because of the need to login, the only way you can accomplish this using Docker is to interactively log into the running Docker container and then from the container bash shell log into softcover.io to run the publishing commands.

This section will show you this process and the commands you need to run.

To run the container in interactive mode we need to run the container with the -it flag and execute the bash command.

```console
docker run --rm -it -v `pwd`:/book softcover/softcover:latest bash
```

This will drop us into the container in the `/book` working directory.

Run the `pwd` command to verify this:

```console
# pwd

\book
```

Now run the following commands in the bash shell to login, build and publish to the softcover service:

```console
sc login
sc clean
sc build:all
sc build:preview
sc publish
# not stricltly nessacary to logout
sc logout
```

We can re-run these commands anytime we wish to update our published book on the softcover.io service.

As an alternative, we can run `sc deploy` command instead of the individual build and publish commands:

```console
sc login
sc clean
# the sc deploy command calls the build:all,build:preview and sc publish
sc deploy
sc logout
```

> Please refer to softcover documentation for full description of all commands

Once we are done publishing, we can exit the bash shell by typing `exit` which will terminate the bash session and the container process.

## Inspecting the published content

Normally if we were logging into softcover by executing the `sc login` command from our host machine we could navigate to the softcover service and be automatically logged in.

However since we logged in from a container instead, we will need to manually log into the softcover website to be able to see our published book or article.

Once you are logged in, you can see your published content.

## Conclusion

In this article I showed you how you can use the softcover docker container to build, locally serve and publish your book or article to the softcover service.

By using the softcover docker image, you don't have to deal with any installation and upgrade issues with the softcover CLI tooling. Furthermore you don't have to modify your development environment with additional tooling that you don't want to have permanently installed.

## Resources

The following links may be helpful:
